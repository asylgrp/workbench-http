parameters:
    env(WORKB_ORG_NAME): "Unknown organization"
    env(WORKB_BASE_DIR): "."
    env(WORKB_DECISIONS_DIR): "decisions"
    env(WORKB_LOG_FILE): "workbench.log"
    env(WORKB_LOG_LEVEL): "notice"
    env(WORKB_LOG_FORMAT): "[{date}] [{level}] {message} {context}"

imports:
    - { resource: event_dispatcher.yaml }
    - { resource: service_layer.yaml }

services:
    _defaults:
        public: false
        autowire: true

    workbench\webb\:
        resource: '../src/*'
        exclude: '../src/{DependencyInjection/ProjectServiceContainer.php}'

    workbench\webb\Http\Route\:
        resource: '../src/Http/Route/*'
        public: true

    Psr\Http\Server\RequestHandlerInterface:
        class: inroutephp\inroute\Runtime\Middleware\Pipeline
        public: true
        arguments:
            - '@workbench\webb\Http\Middleware\ExceptionLogger'
            - '@workbench\webb\Http\Middleware\ExceptionPrettifier'
            - '@Middlewares\TrailingSlash'
            - '@Middlewares\Robots'
            - '@workbench\webb\Http\HttpRouter'

    Middlewares\TrailingSlash: ~

    Middlewares\Robots:
        class: ~
        arguments: [false]

    workbench\webb\Http\HttpRouter:
        class: ~
        calls:
            - method: setContainer
              arguments: ['@Psr\Container\ContainerInterface']

    Psr\Container\ContainerInterface:
        class: workbench\webb\DependencyInjection\ProjectServiceContainer

    Psr\Http\Message\ResponseFactoryInterface:
        class: Zend\Diactoros\ResponseFactory
        public: true

    Psr\Log\LoggerInterface:
        factory: ['@workbench\webb\Utils\LoggerFactory', createLogger]
        arguments:
            - '%env(WORKB_BASE_DIR)%/%env(WORKB_LOG_FILE)%'
            - '%env(WORKB_LOG_LEVEL)%'
            - '%env(WORKB_LOG_FORMAT)%'

    Money\MoneyFormatter:
        class: Money\Formatter\DecimalMoneyFormatter

    Money\MoneyParser:
        class: Money\Parser\DecimalMoneyParser

    Money\Currencies:
        class: Money\Currencies\ISOCurrencies
